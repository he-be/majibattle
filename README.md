# MajiBattle (é­”å­—æ­¦é—˜)

ğŸ® **AIé§†å‹•æ¼¢å­—å‘ªæ–‡ç”Ÿæˆã‚²ãƒ¼ãƒ ** - Cloudflare Workersä¸Šã§å‹•ä½œã™ã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é­”æ³•ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ 

[![Deploy to Cloudflare Workers](https://github.com/he-be/majibattle/actions/workflows/deploy.yml/badge.svg)](https://github.com/he-be/majibattle/actions/workflows/deploy.yml)
![TypeScript](https://img.shields.io/badge/TypeScript-5.1.6-blue)
![Cloudflare Workers](https://img.shields.io/badge/Cloudflare-Workers-orange)
![AI Powered](https://img.shields.io/badge/AI-Gemini%202.5%20Flash-green)

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

MajiBattleã¯ã€4ã¤ã®æ¼¢å­—ã‚’é¸æŠã—ã¦AIãŒå‰µé€ çš„ãªå‘ªæ–‡ã‚’ç”Ÿæˆã™ã‚‹é©æ–°çš„ãªWebã‚²ãƒ¼ãƒ ã§ã™ã€‚Google Gemini APIã¨Stable Diffusion APIã‚’æ´»ç”¨ã—ã€å„å‘ªæ–‡ã«å°‚ç”¨ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

### âœ¨ ä¸»è¦æ©Ÿèƒ½

- **ğŸ§™â€â™‚ï¸ AIå‘ªæ–‡ç”Ÿæˆ**: Google Gemini 2.5ã«ã‚ˆã‚‹å‰µé€ çš„ãªå‘ªæ–‡ä½œæˆ
- **ğŸ¨ è‡ªå‹•ç”»åƒç”Ÿæˆ**: Stable Diffusion XLã«ã‚ˆã‚‹å‘ªæ–‡ã‚¤ãƒ¡ãƒ¼ã‚¸ç”Ÿæˆ
- **ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–UI**: ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®ç¾ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: Cloudflare Workers + Durable Objectsã«ã‚ˆã‚‹é«˜é€Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹
- **ğŸ›¡ï¸ é«˜å“è³ª**: 4å±¤æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹å …ç‰¢ãªé–‹ç™ºç’°å¢ƒ

### ğŸ® ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤

1. **20å€‹ã®æ¼¢å­—**ã‹ã‚‰4ã¤ã‚’é¸æŠ
2. **AIå‘ªæ–‡ç”Ÿæˆ**ã§ç‹¬å‰µçš„ãªé­”æ³•ã‚’å‰µé€ 
3. **å°‚ç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸**ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œå‘ªæ–‡ã‚«ãƒ¼ãƒ‰ãŒå®Œæˆ
4. **ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ **ã§å¸Œå°‘ãªå‘ªæ–‡ã‚’åé›†

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶
- Node.js 20+
- Cloudflare Workers ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Google Gemini API ã‚­ãƒ¼

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/he-be/majibattle.git
cd majibattle

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ç’°å¢ƒå¤‰æ•°è¨­å®š
cp packages/workers/.dev.vars.example packages/workers/.dev.vars
# .dev.varsã«å¿…è¦ãªAPI keyã‚’è¨­å®š

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd packages/workers
npm run dev          # â†’ http://localhost:8787
```

### å¿…è¦ãªç’°å¢ƒå¤‰æ•°

```env
# packages/workers/.dev.vars
GEMINI_API_KEY=your-gemini-api-key
IMAGE_GENERATION_ENABLED=true
CF_CLIENT_ID=your-cloudflare-client-id
CF_SECRET=your-cloudflare-secret
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ç”¨é€” |
|---------|------|------|
| **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ** | Cloudflare Workers | ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å®Ÿè¡Œç’°å¢ƒ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | Durable Objects + SQLite | ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ç®¡ç† |
| **AIå‘ªæ–‡ç”Ÿæˆ** | Google Gemini 2.5 Flash Lite | å‰µé€ çš„ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ |
| **AIç”»åƒç”Ÿæˆ** | Stable Diffusion XL | å‘ªæ–‡ã‚¤ãƒ¡ãƒ¼ã‚¸ç”Ÿæˆ |
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | Vanilla TypeScript | è»½é‡ãƒ»é«˜é€ŸUI |
| **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«** | Vite | é«˜é€Ÿãƒ“ãƒ«ãƒ‰ãƒ»é–‹ç™º |
| **ãƒ†ã‚¹ãƒˆ** | Vitest + Playwright | å˜ä½“ãƒ»E2Eãƒ†ã‚¹ãƒˆ |

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Browser   â”‚ â†â†’ â”‚ Cloudflare Worker â”‚ â†â†’ â”‚ Durable Objects â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚   (Session)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“ â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Gemini API  â”‚    â”‚ Stable Diffusionâ”‚
                        â”‚ (Spell Gen) â”‚    â”‚   (Image Gen)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
majibattle/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ workers/                # Cloudflare Workerså®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts        # ãƒ¡ã‚¤ãƒ³Worker + HTML UI
â”‚   â”‚   â”‚   â”œâ”€â”€ adapters/       # ãƒ‡ãƒ¼ã‚¿å¤‰æ›å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ services/       # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”‚   â””â”€â”€ durable-objects/ # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ wrangler.toml       # Workersè¨­å®š
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ shared/                 # å…±é€šå‹å®šç¾©
â”œâ”€â”€ docs/                       # è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ .github/workflows/          # CI/CDè¨­å®š
â””â”€â”€ README.md
```

## ğŸ”§ é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### å“è³ªä¿è¨¼ - 4å±¤æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ 

```bash
# å¿…é ˆå®Ÿè¡Œé †åº
npm run typecheck    # 1ï¸âƒ£ TypeScriptå‹ãƒã‚§ãƒƒã‚¯
npm run lint         # 2ï¸âƒ£ ESLinté™çš„è§£æ (ç¾åœ¨æœªè¨­å®š)
npm run test:unit    # 3ï¸âƒ£ Vitestå˜ä½“ãƒ†ã‚¹ãƒˆ (ç¾åœ¨æœªè¨­å®š)
npm run test:e2e     # 4ï¸âƒ£ Playwright E2Eãƒ†ã‚¹ãƒˆ (ç¾åœ¨æœªè¨­å®š)
```

### ãã®ä»–ã®é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

```bash
npm run build        # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
npm run deploy       # æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤
npm run dev          # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ (ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰)
```

### GitHub Actions CI/CD

- **Pull Request**: Stagingç’°å¢ƒã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **Main Branch**: Productionç’°å¢ƒã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **å…¨ãƒ–ãƒ©ãƒ³ãƒ**: å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆå‹ãƒã‚§ãƒƒã‚¯ã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼‰

## ğŸŒ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ç’°å¢ƒæ§‹æˆ

| ç’°å¢ƒ | URL | Workerå | Durable Object | ç”¨é€” |
|------|-----|---------|----------------|------|
| **é–‹ç™º** | localhost:8787 | majibattle | GameSession | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º |
| **Staging** | majibattle-staging.*.workers.dev | majibattle-staging | GameSessionV2 | PRæ¤œè¨¼ |
| **æœ¬ç•ª** | majibattle.*.workers.dev | majibattle | GameSessionV3 | æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹ |

### GitHub Secretsè¨­å®š

```bash
# å¿…é ˆSecrets
CLOUDFLARE_API_TOKEN=your-cloudflare-api-token
CLOUDFLARE_ACCOUNT_ID=your-cloudflare-account-id  
GEMINI_API_KEY=your-gemini-api-key
CF_CLIENT_ID=your-cf-client-id
CF_SECRET=your-cf-secret
```

### æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd packages/workers

# Stagingç’°å¢ƒ
npx wrangler deploy --env staging

# Productionç’°å¢ƒ  
npx wrangler deploy --env production
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ç¾åœ¨ã®æ€§èƒ½æŒ‡æ¨™

- **âš¡ ãƒ“ãƒ«ãƒ‰æ™‚é–“**: 142ms
- **ğŸ“¦ ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚º**: 117.50 kB (gzip: 26.98 kB)
- **ğŸš€ APIå¿œç­”æ™‚é–“**: å¹³å‡ < 2ç§’
- **ğŸ¨ ç”»åƒç”Ÿæˆæ™‚é–“**: å¹³å‡ 3.5ç§’
- **âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 121/121 tests passing

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

- **åŒæ™‚ã‚»ãƒƒã‚·ãƒ§ãƒ³**: Durable Objectsã«ã‚ˆã‚‹æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒ«
- **ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹**: Cloudflareã‚¨ãƒƒã‚¸ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ´»ç”¨
- **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã«ã‚ˆã‚‹å¾“é‡èª²é‡‘

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…æ¸ˆã¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- **ğŸ”‘ API Keyç®¡ç†**: Workers Secretsã«ã‚ˆã‚‹å®‰å…¨ãªä¿ç®¡
- **ğŸ›¡ï¸ CORSè¨­å®š**: é©åˆ‡ãªã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³åˆ¶å¾¡
- **ğŸ” Service Auth**: Cloudflare Service Authã«ã‚ˆã‚‹å¤–éƒ¨APIèªè¨¼
- **âš¡ ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: Gemini APIåˆ¶é™ã¸ã®é©åˆ‡ãªå¯¾å¿œ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- Secretsæƒ…å ±ã¯Workers Secretsã®ã¿ã«ä¿ç®¡
- æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã¯ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«å«ã‚ãªã„
- å¤–éƒ¨APIå‘¼ã³å‡ºã—ã¯é©åˆ‡ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ğŸ“– è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[APIè¨­å®šã‚¬ã‚¤ãƒ‰](./docs/API_CONFIGURATION_GUIDE.md)** - APIæ§‹æˆãƒ»ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°
- **[å¤–éƒ¨é€£æºã‚¬ã‚¤ãƒ‰](./docs/EXTERNAL_INTEGRATIONS.md)** - Geminiãƒ»Stable Diffusioné€£æº
- **[é–‹ç™ºã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](./docs/DEVELOPMENT_SETUP.md)** - é–‹ç™ºç’°å¢ƒæ§‹ç¯‰æ‰‹é †
- **[AIé–‹ç™ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ](./CLAUDE.md)** - AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‘ã‘ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

- **[ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](./TROUBLESHOOTING.md)** - ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–
- **[Secretsç®¡ç†ã‚¬ã‚¤ãƒ‰](./docs/secrets-store-implementation-guide.txt)** - Cloudflare Secretsè©³ç´°

## ğŸ¤ è²¢çŒ®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹

1. **Issueç¢ºèª**: GitHub Issuesã§æ©Ÿèƒ½è¦æ±‚ãƒ»ãƒã‚°å ±å‘Šã‚’ç¢ºèª
2. **ãƒ–ãƒ©ãƒ³ãƒä½œæˆ**: `feature/issue-XX-description` å½¢å¼
3. **é–‹ç™º**: 4å±¤æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ã«å¾“ã£ãŸé–‹ç™º
4. **PRä½œæˆ**: è©³ç´°ãªå¤‰æ›´å†…å®¹ã¨å½±éŸ¿ç¯„å›²ã‚’è¨˜è¼‰
5. **ãƒ¬ãƒ“ãƒ¥ãƒ¼**: CI/CDãƒã‚§ãƒƒã‚¯é€šéå¾Œã«ãƒãƒ¼ã‚¸

### ã‚³ãƒ¼ãƒ‰å“è³ªåŸºæº–

- âœ… TypeScript strict mode
- âœ… ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­ï¼ˆå‹ãƒã‚§ãƒƒã‚¯ãƒ»Lintï¼‰
- âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç¶­æŒ
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ–ãªã—

## ğŸ“ˆ ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### å®Œäº†æ¸ˆã¿æ©Ÿèƒ½

- âœ… åŸºæœ¬çš„ãªå‘ªæ–‡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
- âœ… AIç”»åƒç”Ÿæˆçµ±åˆ
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–UIè¨­è¨ˆ
- âœ… æ°‘ä¿—å­¦ã‚¹ã‚¿ã‚¤ãƒ«å‘ªæ–‡å¯¾å¿œ
- âœ… ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 
- âœ… 4å±¤æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ 

### ä»Šå¾Œã®è¨ˆç”»

- ğŸ”„ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ©Ÿèƒ½
- ğŸ”„ å‘ªæ–‡ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- ğŸ”„ ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯¾æˆ¦
- ğŸ”„ SNSå…±æœ‰æ©Ÿèƒ½
- ğŸ”„ ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªåŒ–

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ™ è¬è¾

- **Google Gemini** - é©æ–°çš„ãªAIå‘ªæ–‡ç”Ÿæˆ
- **Stable Diffusion** - ç¾ã—ã„å‘ªæ–‡ã‚¤ãƒ¡ãƒ¼ã‚¸ç”Ÿæˆ
- **Cloudflare** - é«˜æ€§èƒ½ãªã‚¨ãƒƒã‚¸ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°åŸºç›¤

---

**ğŸ¤– AI-Driven Development Project** | Made with â¤ï¸ by [Claude Code](https://claude.ai/code)
